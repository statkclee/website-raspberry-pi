<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>xwMOOC: </title>
    <link rel="shortcut icon" type="image/x-icon" href="https://statkclee.github.io/website-raspberry-pi/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="http://statkclee.github.io/website-raspberry-pi/css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://statkclee.github.io/website-raspberry-pi/css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="http://statkclee.github.io/website-raspberry-pi/css/swc.css" />
    <!-- <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/> -->
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://www.xwmooc.net" title="xwMOOC 한글 컴퓨터 과학 언플러그드">
          <img alt="xwMOOC banner" src="http://statkclee.github.io/website-raspberry-pi/img/xwMOOC-logo.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <h1 class="title"></h1>
          <h1 id="controlling-physical-devices-across-a-network-on-two-raspberry-pis-student-worksheet">Controlling physical devices across a network on two Raspberry Pis: Student worksheet</h1>
<p>There are three steps to setting up the Raspberry Pis so one can control the other: configuring the network, writing the server program, and setting up the hardware.</p>
<h2 id="network-configuration">Network configuration</h2>
<p>Before the Raspberry Pis can communicate they need to be connected together via a network. Normally, when a device connects to a network, it is assigned a unique identifier called an IP address. As we only have two Raspberry Pis we have to give each Pi its own IP address.</p>
<ol style="list-style-type: decimal">
<li><p><a href="../rpi-static-ip-address.md">Follow this guide</a> to configure the IP address.</p></li>
<li><p>Repeat this procedure with your other Pi, giving this one the IP address <code>192.168.0.3</code>.</p></li>
</ol>
<p><strong>Tip:</strong> Use a Post-it note to physically label the Raspberry Pis with their IP addresses otherwise things will get confusing later!</p>
<h3 id="testing-your-network">Testing your network</h3>
<ol style="list-style-type: decimal">
<li>Connect the two Pis with an Ethernet cable</li>
<li><p>On the Pi that has the IP address ending <code>.02</code>, type:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ping</span> 192.168.0.3 -c5</code></pre></li>
</ol>
<p>You should see something like this:</p>
<pre><code>PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.
64 bytes from 192.168.0.3: icmp_req=1 ttl=128 time=3.46 ms
[...four more PINGs ...]

--- 192.168.0.3 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4007ms
rtt min/avg/max/mdev = 3.466/3.788/4.380/0.322 ms</code></pre>
<p>If not, check your edits and the network cable. Once the Raspberry Pis are successfully networked you are ready to write the chat program.</p>
<h2 id="setting-up-the-control-program">Setting up the control program</h2>
<ol style="list-style-type: decimal">
<li>Create a new file with the nano editor by typing <code>nano thing-server.py</code>.</li>
<li><p>Type in the following program:</p>
<p>```python import RPi.GPIO as GPIO import time import network</p>
<p>SWITCH = 10 GPIO.setmode(GPIO.BCM) GPIO.setup(SWITCH, GPIO.IN)</p>
<p>def heard(phrase): print “heard:” + phrase for a in phrase: if a == “” or a == “”: pass # strip it else: if (GPIO.input(SWITCH)): network.say(“1”) else: network.say(“0”)</p>
<p>while True: print “waiting for connection” network.wait(whenHearCall=heard) print “connected”</p>
<p>while network.isConnected(): print “server is running”<br /> time.sleep(1)</p>
<p>print “connection closed” ```</p></li>
<li><p>Save the file with <code>CTRL-O</code> and then exit nano with <code>CTRL-X</code>.</p></li>
</ol>
<h2 id="setting-up-the-hardware">Setting up the hardware</h2>
<p><strong>Important</strong>: do not connect hardware directly to the pins! Use female header wires that you can plug onto the GPIO pins and your hardware.</p>
<h3 id="set-up-the-client-machine-with-an-led">1. Set up the client machine with an LED</h3>
<div class="figure">
<img src="images/client-led-setup.png" />
</div>
<h3 id="set-up-the-server-with-a-button">2. Set up the server with a button</h3>
<p>Note: you do not need a button, just something to connect the GPIO pin to the ground pin. It could be two paper clips or similar. Again, use header wires that protect the GPIO pins.</p>
<div class="figure">
<img src="images/server-button-setup.png" />
</div>
<h2 id="running-the-program">Running the program</h2>
<p>The <strong>server</strong> machine is connected to a button. It monitors data from the client machine, and when it receives a ‘?’ character it sends back a ‘1’ if the button is pressed and a ‘0’ if it is not.</p>
<p>The <strong>client</strong> machine is connected to an LED. It sends a ‘?’ character every second to the server, and if it gets back a ‘1’ in reply it turns the LED on.</p>
<ol style="list-style-type: decimal">
<li><p>Set the first Pi up as a <strong>server</strong> by typing:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">python</span> thing-server.py</code></pre></li>
<li><p>The second Pi will be the <strong>client</strong>. You need to tell it the IP address of the server that you want to connect to. For example, to connect to the Raspberry Pi that has the IP address ending in <code>.2.</code>, type:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">python</span> thing-client.py 192.168.0.2</code></pre></li>
<li><p>You should now be able to press the button on the Raspberry Pi connected to the server, and the LED will flash on the client. Try it out!</p></li>
</ol>
<h3 id="things-to-think-about">Things to think about:</h3>
<ul>
<li>What is happening, physically and electrically, when you press the button?</li>
<li>What happens at the other end, electrically, when the server receives a signal?</li>
</ul>
<h3 id="things-to-try">Things to try:</h3>
<ul>
<li>Can you break the program by pressing the button too fast?</li>
<li>Try to change the frequency of the client requests (the <code>?</code> character). What happens if they get sent too fast?</li>
<li>What happens if you stop the server program by pressing <code>CTRL-C</code>?</li>
</ul>
<h3 id="programming-challenges">Programming challenges</h3>
<ul>
<li>Change the message that appears when your program starts.</li>
<li>Change the message that appears when a client connects.</li>
<li>Change the character the client sends every second. Does it matter?</li>
<li>Make the LED flash more quickly.</li>
<li>Make the LED flash for a random length of time.</li>
<li>Comment your code to explain what each section does.</li>
</ul>
<h1 id="cleanup">Cleanup</h1>
<p>If the teacher asks you to, change the network configuration back to a dynamic IP address as shown in the “Clean up” section of <a href="rpi-static-ip-address.md">the guide</a>.</p>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://www.xwmooc.net">xwMOOC</a>
        <a class="label swc-blue-bg" href="https://github.com/statkclee/website-raspberry-pi/">Source</a>
        <a class="label swc-blue-bg" href="mailto:i@xwmooc.net">Contact</a>
        <a class="label swc-blue-bg" href="http://statkclee.github.io/website-raspberry-pi/LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="https://statkclee.github.io/website-csunplugged/css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
